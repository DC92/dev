<!-- IF GEO_MAP_TYPE and POST_ID == TOPIC_FIRST_POST_ID -->

<!-- Openlayers -->
<!-- INCLUDECSS assets/MyOl/ol/ol.css -->
<!-- INCLUDEJS assets/MyOl/ol/ol.js -->

<!-- Recherche par nom -->
<!-- INCLUDECSS assets/MyOl/geocoder/ol-geocoder.min.css -->
<!-- INCLUDEJS assets/MyOl/geocoder/ol-geocoder.js -->

<!-- IF GEO_MAP_TYPE -->
<!-- Proj4 projections Swiss & UK -->
<!-- //TODO CHEM pour all : INCLUDEJS assets/MyOl/proj4/proj4.js -->

<!-- My Openlayers -->
<!-- INCLUDECSS assets/MyOl/myol.css -->
<!-- INCLUDEJS assets/MyOl/myol.js -->
<!-- ENDIF -->

<!-- GeoBB -->
<!-- INCLUDECSS geobb.css -->
<!-- INCLUDEJS geobb.js -->

<div class="map" id="map"></div>

<script>
	var map, editable;

	window.addEventListener('load', function() {
		var overlay = geoLayer({TOPIC_ID}, true), //TODO BEST ne pas afficher du tout le polygone TOPIC_ID
			edit = controlEdit('editable-json', [overlay], true),
			poly = controlEditCreate('Polygon'),
			extent = edit.source.getExtent(),
			permalink = controlPermalink({
				init: ol.extent.isEmpty(extent),
				visible: true
			});
		map = new ol.Map({
			target: 'map',
			layers: [
				overlay
			],
			controls: geobbControls().concat([
				controlLayersSwitcher(
					layers({GEO_KEYS})
				),
				<!-- IF GEO_MAP_TYPE == 'surface' -->
					edit,
					poly,
				<!-- ENDIF -->
				permalink
			])
		});

		<!-- IF GEO_MAP_TYPE == 'point' -->
			editable = marker('{EXT_DIR}images/viseur.png', 'editable', permalink.paramsCenter, true);
			map.addLayer(editable);
		<!-- ENDIF -->

		// Center the map
		if(!ol.extent.isEmpty(extent))
			map.getView().fit(
				extent, {
					maxZoom: 15
				}
			);
	});
</script>

<dl class="posting-point" style="clear: left;">
	<input id="editable-json" name="geom-geometry" type="hidden" value='{GEOJSON}' />
	<!-- //TODO CHEM pour all :
		<p>Massif <input type="text" name="geo_massif-varchar-50" size="25" class="inputbox autowidth" value="{GEO_MASSIF}" /> (*)</p>
	-->

	<!-- IF GEO_MAP_TYPE == 'point' -->
		<p>
			Lon <input id="editable-lon" type="text" onchange="editable.edit(this,0,4326)" size="10" maxlength="12"/>
			Lat <input id="editable-lat" type="text" onchange="editable.edit(this,1,4326)" size="10" maxlength="12"/>
		</p>
		<p id="editable-xy">Suisse
			X <input id="editable-x" type="text" onchange="editable.edit(this,0,21781)" size="7" maxlength="12"/>
			Y <input id="editable-y" type="text" onchange="editable.edit(this,1,21781)" size="7" maxlength="12"/>
		</p>

		<p><a style="cursor:pointer" onclick="map.getView().setCenter(editable.getPoint().getCoordinates())">Recentrer la carte sur le curseur</a></p>
		<p><a style="cursor:pointer" onclick="editable.getPoint().setCoordinates(map.getView().getCenter())">Remettre le curseur au centre actuel de la carte</a></p>
		<p><a style="cursor:pointer" onclick="geobbControlGps.action()">Utiliser la position du GPS</a></p>
	<!-- ENDIF -->

	<!-- //TODO CHEM pour all p>(*) Vider le champ ou le laisser vide pour que le serveur le d√©termine automatiquement.</p -->

	<p class="remarques">Autres remarques ou commentaires :</p>
</dl>

<!-- Application specific info -->
<!-- BEGIN info -->
	<{info.TAG1}{info.ATT_STYLE}>{info.INNER}
		<!-- IF info.TAG == 'select' -->
			<select{info.ATT_TYPE}{info.ATT_NAME}>
			<!-- BEGIN options -->
				<option value="{options.OPTION}" <!-- IF info.POST_VALUE == options.OPTION -->selected="selected"<!-- ENDIF -->>{options.OPTION}</option> 
			<!-- END options -->
			</select>
		<!-- ELSEIF info.TAG == 'textarea' -->
			<br/><textarea{info.ATT_NAME}{info.ATT_ROWS} cols="60" class="inputbox autowidth"
			{info.ATT_PLACEHOLDER}>{info.POST_VALUE}</textarea>
		<!-- ELSEIF info.TAG -->
			<{info.TAG}{info.ATT_NAME}{info.ATT_TYPE}{info.ATT_SIZE}{info.ATT_CLASS}
			{info.ATT_PLACEHOLDER}{info.ATT_POST_VALUE}></{info.TAG}> {info.POSTAMBULE}
		<!-- ENDIF -->
	</{info.TAG1}>
<!-- END info -->

<!-- ENDIF -->
